<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualización de σ-alineamiento</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .programs-container {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .program {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .monitor-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            min-height: 600px;
        }
        
        .program::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .monitor-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .program-title {
            text-align: center;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .code-line {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 2px 0;
            border-radius: 6px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .line-number {
            width: 30px;
            color: #888;
            font-size: 0.9em;
            margin-right: 15px;
            text-align: right;
        }
        
        .code-content {
            flex: 1;
            font-family: 'Consolas', monospace;
        }
        
        .shared {
            background: rgba(52, 152, 219, 0.2);
            border-left: 4px solid #3498db;
            transform: translateX(2px);
        }
        
        .specific {
            background: rgba(241, 196, 15, 0.2);
            border-left: 4px solid #f39c12;
        }
        
        .execution-path {
            background: rgba(231, 76, 60, 0.3);
            border-left: 4px solid #e74c3c;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }
        
        .current-step {
            background: rgba(155, 89, 182, 0.4);
            border-left: 4px solid #9b59b6;
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.5);
            transform: scale(1.02);
        }
        
        .keyword { color: #8e44ad; font-weight: bold; }
        .type { color: #3498db; font-weight: bold; }
        .function { color: #e67e22; font-weight: bold; }
        .string { color: #27ae60; }
        .number { color: #e74c3c; }
        .comment { color: #95a5a6; font-style: italic; }
        
        /* Estilos del monitor */
        .monitor {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
            stroke-width: 2;
        }
        
        /* Estilos por tipo de nodo según el DOT */
        .node.nv-ellipse {
            fill: #AFEEEE; /* lightcyan2 */
            stroke: #4682B4;
        }
        
        .node.nv-diamond {
            fill: #EEE8AA; /* lightgoldenrod2 */
            stroke: #DAA520;
        }
        
        .node.v-diamond {
            fill: #ADFF2F; /* darkolivegreen3 */
            stroke: #6B8E23;
        }
        
        .node.iv-diamond {
            fill: #F08080; /* lightcoral */
            stroke: #CD5C5C;
        }
        
        .node.current {
            fill: #9b59b6;
            stroke: #8e44ad;
            stroke-width: 4;
            filter: drop-shadow(0 0 15px #9b59b6);
        }
        
        .node:hover {
            filter: brightness(1.1);
        }
        
        .edge {
            stroke: #555;
            stroke-width: 1.2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .edge.decision-then {
            stroke: #27ae60;
            stroke-width: 2;
            marker-end: url(#arrowhead-then);
        }
        
        .edge.decision-else {
            stroke: #e74c3c;
            stroke-width: 2;
            marker-end: url(#arrowhead-else);
        }
        
        .edge.active {
            stroke: #9b59b6;
            stroke-width: 3.5;
            animation: pulse 1.2s infinite;
            marker-end: url(#arrowhead-active);
        }
        
        @keyframes pulse {
            0% { stroke-opacity: 1; }
            50% { stroke-opacity: 0.6; }
            100% { stroke-opacity: 1; }
        }
        
        .node-label {
            text-anchor: middle;
            dominant-baseline: central;
            font-family: 'Consolas', monospace;
            font-size: 11px;
            font-weight: bold;
            fill: #222;
            pointer-events: none;
        }
        
        .edge-label {
            text-anchor: middle;
            dominant-baseline: central;
            font-family: 'Consolas', monospace;
            font-size: 8px;
            font-weight: bold;
            fill: #444;
            pointer-events: none;
        }
        
        .edge-label-bg {
            fill: rgba(255, 255, 255, 0.9);
            stroke: rgba(200, 200, 200, 0.8);
            stroke-width: 0.5;
            rx: 3;
            ry: 3;
        }
        
        .sigma-mapping {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            color: #333;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .sigma-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }
        
        .mapping-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mapping-pair {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        
        .mapping-pair:hover {
            transform: translateY(-2px);
        }
        
        .execution-analysis {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            color: #333;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .scenario {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .scenario-title {
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .path {
            background: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            margin: 10px 0;
        }
        
        .alignment-result {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            font-size: 1.2em;
        }
        
        .aligned {
            background: rgba(52, 152, 219, 0.2);
            border-left: 4px solid #3498db;
            color: #2980b9;
        }
        
        .misaligned {
            background: rgba(231, 76, 60, 0.2);
            border-left: 4px solid #e74c3c;
            color: #e74c3c;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .step-controls {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            text-align: center;
        }
        
        .step-controls-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .step-info {
            font-size: 1.1em;
            color: #ecf0f1;
            margin: 0;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .shared-color { background: #3498db; }
        .specific-color { background: #f39c12; }
        .execution-color { background: #e74c3c; }
        .current-color { background: #9b59b6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Visualización de σ-alineamiento</h1>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color shared-color"></div>
                <span>Código Compartido (σ)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color specific-color"></div>
                <span>Código Específico</span>
            </div>
            <div class="legend-item">
                <div class="legend-color execution-color"></div>
                <span>Ruta de Ejecución</span>
            </div>
            <div class="legend-item">
                <div class="legend-color current-color"></div>
                <span>Paso Actual</span>
            </div>
        </div>
        
        <div class="programs-container">
            <div class="program">
                <div class="program-title">Programa Oráculo (OP)</div>
                <div class="code-line shared" data-line="2">
                    <div class="line-number">2</div>
                    <div class="code-content"><span class="type">int</span> R = <span class="number">10</span>;</div>
                </div>
                <div class="code-line shared" data-line="3">
                    <div class="line-number">3</div>
                    <div class="code-content"><span class="type">int</span> P = <span class="function">argv</span>[<span class="number">1</span>] ? <span class="function">atoi</span>(<span class="function">argv</span>[<span class="number">1</span>]) : <span class="number">0</span>;</div>
                </div>
                <div class="code-line shared" data-line="4">
                    <div class="line-number">4</div>
                    <div class="code-content"><span class="type">int</span> A = <span class="number">0</span>;</div>
                </div>
                <div class="code-line shared" data-line="6">
                    <div class="line-number">6</div>
                    <div class="code-content"><span class="keyword">if</span> (<span class="function">Cond1</span>(P)) {</div>
                </div>
                <div class="code-line shared" data-line="7">
                    <div class="line-number">7</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;A = <span class="function">AComputation</span>(P);</div>
                </div>
                <div class="code-line shared" data-line="8">
                    <div class="line-number">8</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (<span class="function">Cond</span>(A)) {</div>
                </div>
                <div class="code-line shared" data-line="9">
                    <div class="line-number">9</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R = <span class="function">HeavyRComputation</span>(P, A);</div>
                </div>
                <div class="code-line specific" data-line="10">
                    <div class="line-number">10</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {</div>
                </div>
                <div class="code-line specific" data-line="11">
                    <div class="line-number">11</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R = <span class="function">RComputation</span>(P, A);</div>
                </div>
                <div class="code-line specific" data-line="12">
                    <div class="line-number">12</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;}</div>
                </div>
                <div class="code-line specific" data-line="13">
                    <div class="line-number">13</div>
                    <div class="code-content">}</div>
                </div>
                <div class="code-line shared" data-line="15">
                    <div class="line-number">15</div>
                    <div class="code-content"><span class="keyword">return</span> R;</div>
                </div>
            </div>
            
            <div class="program">
                <div class="program-title">Programa Bajo Análisis (PUA)</div>
                <div class="code-line shared" data-line="2">
                    <div class="line-number">2</div>
                    <div class="code-content"><span class="type">int</span> R = <span class="number">10</span>;</div>
                </div>
                <div class="code-line shared" data-line="3">
                    <div class="line-number">3</div>
                    <div class="code-content"><span class="type">int</span> P = <span class="function">argv</span>[<span class="number">1</span>] ? <span class="function">atoi</span>(<span class="function">argv</span>[<span class="number">1</span>]) : <span class="number">0</span>;</div>
                </div>
                <div class="code-line shared" data-line="4">
                    <div class="line-number">4</div>
                    <div class="code-content"><span class="type">int</span> A = <span class="number">0</span>;</div>
                </div>
                <div class="code-line specific" data-line="6">
                    <div class="line-number">6</div>
                    <div class="code-content"><span class="keyword">if</span> (<span class="function">Cond0</span>(P)) {</div>
                </div>
                <div class="code-line specific" data-line="7">
                    <div class="line-number">7</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="function">logMessage</span>(<span class="string">"Error0"</span>);</div>
                </div>
                <div class="code-line specific" data-line="8">
                    <div class="line-number">8</div>
                    <div class="code-content">} <span class="keyword">else</span> {</div>
                </div>
                <div class="code-line shared" data-line="9">
                    <div class="line-number">9</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (<span class="function">Cond1</span>(P)) {</div>
                </div>
                <div class="code-line shared" data-line="10">
                    <div class="line-number">10</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A = <span class="function">AComputation</span>(P);</div>
                </div>
                <div class="code-line shared" data-line="11">
                    <div class="line-number">11</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (<span class="function">Cond</span>(A)) {</div>
                </div>
                <div class="code-line shared" data-line="12">
                    <div class="line-number">12</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R = <span class="function">HeavyRComputation</span>(P, A);</div>
                </div>
                <div class="code-line specific" data-line="13">
                    <div class="line-number">13</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {</div>
                </div>
                <div class="code-line specific" data-line="14">
                    <div class="line-number">14</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R = <span class="function">ChangedRComputation</span>(P, A);</div>
                </div>
                <div class="code-line specific" data-line="15">
                    <div class="line-number">15</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
                </div>
                <div class="code-line specific" data-line="16">
                    <div class="line-number">16</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {</div>
                </div>
                <div class="code-line specific" data-line="17">
                    <div class="line-number">17</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="function">logMessage</span>(<span class="string">"Error"</span>);</div>
                </div>
                <div class="code-line specific" data-line="18">
                    <div class="line-number">18</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;}</div>
                </div>
                <div class="code-line specific" data-line="19">
                    <div class="line-number">19</div>
                    <div class="code-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="function">logValue</span>(R);</div>
                </div>
                <div class="code-line specific" data-line="20">
                    <div class="line-number">20</div>
                    <div class="code-content">}</div>
                </div>
                <div class="code-line shared" data-line="22">
                    <div class="line-number">22</div>
                    <div class="code-content"><span class="keyword">return</span> R;</div>
                </div>
            </div>
            
            <div class="monitor-container">
                <div class="program-title">Monitor de Control PUA</div>
                <svg class="monitor" id="monitorSvg" viewBox="0 0 400 600">
                    <!-- Definición de marcadores para flechas -->
                    <defs>
                        <marker id="arrowhead" markerWidth="8" markerHeight="6" 
                                refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                            <polygon points="0 0, 8 3, 0 6" fill="#555" />
                        </marker>
                        <marker id="arrowhead-active" markerWidth="8" markerHeight="6" 
                                refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                            <polygon points="0 0, 8 3, 0 6" fill="#9b59b6" />
                        </marker>
                        <marker id="arrowhead-then" markerWidth="8" markerHeight="6" 
                                refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                            <polygon points="0 0, 8 3, 0 6" fill="#27ae60" />
                        </marker>
                        <marker id="arrowhead-else" markerWidth="8" markerHeight="6" 
                                refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                            <polygon points="0 0, 8 3, 0 6" fill="#e74c3c" />
                        </marker>
                    </defs>
                    
                    <!-- Nodos del monitor basados en el DOT -->
                    <!-- Nodo 1: Estado inicial NV diamond -->
                    <polygon class="node nv-diamond" id="node-1" points="200,30 220,50 200,70 180,50" />
                    <text class="node-label" x="200" y="50">1:NV</text>
                    
                    <!-- Nodo 2: NV ellipse -->
                    <ellipse class="node nv-ellipse" id="node-2" cx="200" cy="120" rx="25" ry="15" />
                    <text class="node-label" x="200" y="120">2:NV</text>
                    
                    <!-- Nodo 3: NV ellipse -->
                    <ellipse class="node nv-ellipse" id="node-3" cx="200" cy="190" rx="25" ry="15" />
                    <text class="node-label" x="200" y="190">3:NV</text>
                    
                    <!-- Nodo 4: NV ellipse -->
                    <ellipse class="node nv-ellipse" id="node-4" cx="200" cy="260" rx="25" ry="15" />
                    <text class="node-label" x="200" y="260">4:NV</text>
                    
                    <!-- Nodo -1: IV diamond (error) -->
                    <polygon class="node iv-diamond" id="node--1" points="80,330 100,350 80,370 60,350" />
                    <text class="node-label" x="80" y="350">-1:IV</text>
                    
                    <!-- Nodo 6: NV ellipse -->
                    <ellipse class="node nv-ellipse" id="node-6" cx="320" cy="330" rx="25" ry="15" />
                    <text class="node-label" x="320" y="330">6:NV</text>
                    
                    <!-- Nodo 7: NV ellipse -->
                    <ellipse class="node nv-ellipse" id="node-7" cx="320" cy="400" rx="25" ry="15" />
                    <text class="node-label" x="320" y="400">7:NV</text>
                    
                    <!-- Nodo -2: V diamond (válido) -->
                    <polygon class="node v-diamond" id="node--2" points="120,470 140,490 120,510 100,490" />
                    <text class="node-label" x="120" y="490">-2:V</text>
                    
                    <!-- Nodo 8: NV ellipse -->
                    <ellipse class="node nv-ellipse" id="node-8" cx="320" cy="470" rx="25" ry="15" />
                    <text class="node-label" x="320" y="470">8:NV</text>
                    
                    <!-- Nodo 10: NV ellipse -->
                    <ellipse class="node nv-ellipse" id="node-10" cx="320" cy="540" rx="25" ry="15" />
                    <text class="node-label" x="320" y="540">10:NV</text>
                    
                    <!-- Aristas del monitor -->
                    <!-- 1 -> 2 -->
                    <path class="edge" id="edge-1-2" d="M 200 70 L 200 105" marker-end="url(#arrowhead)" />
                    <rect class="edge-label-bg" x="210" y="82" width="100" height="12" />
                    <text class="edge-label" x="260" y="88">int P = argv[1]...</text>
                    
                    <!-- 2 -> 3 (bifurcación then/else) -->
                    <path class="edge decision-then" id="edge-2-3-then" d="M 190 135 Q 185 155 190 175" marker-end="url(#arrowhead-then)" />
                    <rect class="edge-label-bg" x="168" y="150" width="20" height="12" />
                    <text class="edge-label" x="178" y="156">then</text>
                    
                    <path class="edge decision-else" id="edge-2-3-else" d="M 210 135 Q 215 155 210 175" marker-end="url(#arrowhead-else)" />
                    <rect class="edge-label-bg" x="218" y="150" width="20" height="12" />
                    <text class="edge-label" x="228" y="156">else</text>
                    
                    <!-- 3 -> 4 -->
                    <path class="edge" id="edge-3-4" d="M 200 205 L 200 245" marker-end="url(#arrowhead)" />
                    <rect class="edge-label-bg" x="210" y="220" width="80" height="12" />
                    <text class="edge-label" x="250" y="226">if (Cond0(P))?</text>
                    
                    <!-- 4 -> -1 (then) -->
                    <path class="edge decision-then" id="edge-4--1" d="M 175 265 Q 130 290 100 335" marker-end="url(#arrowhead-then)" />
                    <rect class="edge-label-bg" x="125" y="295" width="20" height="12" />
                    <text class="edge-label" x="135" y="301">then</text>
                    
                    <!-- 4 -> 6 (else) -->
                    <path class="edge decision-else" id="edge-4-6" d="M 225 265 Q 270 290 295 325" marker-end="url(#arrowhead-else)" />
                    <rect class="edge-label-bg" x="270" y="295" width="20" height="12" />
                    <text class="edge-label" x="280" y="301">else</text>
                    
                    <!-- 6 -> 7 -->
                    <path class="edge" id="edge-6-7" d="M 320 345 L 320 385" marker-end="url(#arrowhead)" />
                    <rect class="edge-label-bg" x="330" y="360" width="80" height="12" />
                    <text class="edge-label" x="370" y="366">if (Cond1(P))?</text>
                    
                    <!-- 7 -> 8 (then) -->
                    <path class="edge decision-then" id="edge-7-8" d="M 320 415 L 320 455" marker-end="url(#arrowhead-then)" />
                    <rect class="edge-label-bg" x="330" y="430" width="20" height="12" />
                    <text class="edge-label" x="340" y="436">then</text>
                    
                    <!-- 7 -> -2 (else) -->
                    <path class="edge decision-else" id="edge-7--2" d="M 295 405 Q 210 440 140 485" marker-end="url(#arrowhead-else)" />
                    <rect class="edge-label-bg" x="200" y="440" width="20" height="12" />
                    <text class="edge-label" x="210" y="446">else</text>
                    
                    <!-- 8 -> 10 -->
                    <path class="edge" id="edge-8-10" d="M 320 485 L 320 525" marker-end="url(#arrowhead)" />
                    <rect class="edge-label-bg" x="330" y="500" width="70" height="12" />
                    <text class="edge-label" x="365" y="506">if (Cond(A))?</text>
                    
                    <!-- 10 -> -2 (then) -->
                    <path class="edge decision-then" id="edge-10--2" d="M 295 545 Q 210 535 140 505" marker-end="url(#arrowhead-then)" />
                    <rect class="edge-label-bg" x="200" y="520" width="20" height="12" />
                    <text class="edge-label" x="210" y="526">then</text>
                    
                    <!-- 10 -> -1 (else) -->
                    <path class="edge decision-else" id="edge-10--1" d="M 295 535 Q 190 480 100 365" marker-end="url(#arrowhead-else)" />
                    <rect class="edge-label-bg" x="180" y="450" width="20" height="12" />
                    <text class="edge-label" x="190" y="456">else</text>
                </svg>
            </div>
        </div>
        
        <div class="sigma-mapping">
            <div class="sigma-title">Relación de Emparejamiento σ</div>
            <div class="mapping-grid">
                <div class="mapping-pair">(2,2)</div>
                <div class="mapping-pair">(3,3)</div>
                <div class="mapping-pair">(4,4)</div>
                <div class="mapping-pair">(6,9)</div>
                <div class="mapping-pair">(7,10)</div>
                <div class="mapping-pair">(8,11)</div>
                <div class="mapping-pair">(9,12)</div>
                <div class="mapping-pair">(15,22)</div>
            </div>
            <p style="text-align: center; color: #7f8c8d; font-style: italic;">
                Cada par (OP, PUA) representa líneas de código compartido entre ambos programas
            </p>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="showScenario1()">Escenario 1: Imposible de alinear, IV</button>
            <button class="btn" onclick="showScenario2()">Escenario 2: Alineadas, V</button>
            <button class="btn" onclick="clearExecution()">Limpiar Ejecución</button>
        </div>
        
        <div class="step-controls" id="stepControls">
            <div class="step-controls-row">
                <span class="step-info" id="stepInfo">Paso 1 de 6</span>
                <button class="btn" onclick="prevStep()" id="prevBtn">⬅ Anterior</button>
                <button class="btn" onclick="nextStep()" id="nextBtn">Siguiente ➡</button>
                <button class="btn" onclick="playExecution()" id="playBtn">▶ Reproducir</button>
            </div>
        </div>
        
        <div class="execution-analysis">
            <div class="sigma-title" id="alignmentTitle">Análisis de σ-alineamiento</div>
            <div id="execution-content">
                <p style="text-align: center; color: #7f8c8d; font-style: italic;">
                    Selecciona un escenario para analizar el σ-alineamiento
                </p>
            </div>
        </div>
    </div>
    
    <script>
        let currentScenario = null;
        let currentStep = 0;
        let executionSteps = [];
        let isPlaying = false;
        let playInterval = null;
        
        function clearExecution() {
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('execution-path', 'current-step');
                // Restaurar colores originales
                const lineNum = parseInt(line.getAttribute('data-line'));
                if ([2, 3, 4, 6, 7, 8, 9, 15].includes(lineNum) && line.closest('.program').querySelector('.program-title').textContent.includes('Oráculo')) {
                    line.classList.add('shared');
                } else if ([2, 3, 4, 9, 10, 11, 12, 22].includes(lineNum) && line.closest('.program').querySelector('.program-title').textContent.includes('Análisis')) {
                    line.classList.add('shared');
                } else {
                    line.classList.add('specific');
                }
            });
            
            // Limpiar monitor
            document.querySelectorAll('.node').forEach(node => {
                node.classList.remove('current');
            });
            document.querySelectorAll('.edge').forEach(edge => {
                edge.classList.remove('active');
                edge.setAttribute('marker-end', 'url(#arrowhead)');
            });
            
            document.getElementById('stepControls').style.display = 'none';
            document.getElementById('alignmentTitle').textContent = 'Análisis de σ-alineamiento';
            document.getElementById('execution-content').innerHTML = `
                <p style="text-align: center; color: #7f8c8d; font-style: italic;">
                    Selecciona un escenario para analizar el σ-alineamiento
                </p>
            `;
            
            currentScenario = null;
            currentStep = 0;
            executionSteps = [];
            stopPlayback();
        }
        
        function showScenario1() {
            clearExecution();
            currentScenario = 1;
            
            // Definir los pasos de ejecución para el monitor
            executionSteps = [
                { op: [2], pua: [2], description: "Inicialización de R = 10", node: "node-1", edges: ["edge-1-2"] },
                { op: [3], pua: [3], description: "Lectura del parámetro P", node: "node-2", edges: ["edge-2-3-then", "edge-2-3-else"] },
                { op: [4], pua: [4], description: "Inicialización de A = 0", node: "node-3", edges: ["edge-3-4"] },
                { op: [], pua: [6], description: "Evaluación de Cond0(P) = True", node: "node-4", edges: ["edge-4--1"] },
                { op: [], pua: [7], description: "Ejecución de logMessage('Error0')", node: "node--1", edges: [] },
                { op: [], pua: [22], description: "Retorno de R - Estado IV (Invalid)", node: "node--1", edges: [] }
            ];
            
            // Resaltar todas las rutas de ejecución
            const puaLines = [2, 3, 4, 6, 7, 22];
            const opLines = [2, 3, 4];
            
            highlightExecutionPath(opLines, puaLines);
            
            document.getElementById('alignmentTitle').textContent = 'NO σ-ALINEADAS';
            document.getElementById('execution-content').innerHTML = `
                <div class="scenario">
                    <div class="scenario-title">Escenario 1: Cond0(P) = True</div>
                    <div class="path">
                        <strong>Ruta PUA:</strong> 2 → 3 → 4 → 6 → 7 → 22<br>
                        <strong>Nodos σ en PUA:</strong> 2, 3, 4, 22
                    </div>
                    <div class="path">
                        <strong>Ruta OP (prefijo):</strong> 2 → 3 → 4<br>
                        <strong>Nodos σ en OP:</strong> 2, 3, 4
                    </div>
                    <div class="path">
                        <strong>Flujo del Monitor:</strong> 1(NV) → 2(NV) → 3(NV) → 4(NV) → -1(IV)<br>
                        <strong>Estado Final:</strong> IV (Invalid) - Violación detectada
                    </div>
                    <div class="alignment-result misaligned">
                        ❌ NO σ-ALINEADAS
                    </div>
                    <p><strong>Razón:</strong> El PUA ejecuta la línea 22 (emparejada con 15 del OP) sin que el OP ejecute su línea correspondiente. El monitor detecta esta violación y lleva al estado IV (Invalid).</p>
                </div>
            `;
            
            setupStepControls();
        }
        
        function showScenario2() {
            clearExecution();
            currentScenario = 2;
            
            // Definir los pasos de ejecución alineados para el monitor
            executionSteps = [
                { op: [2], pua: [2], description: "Inicialización de R = 10", node: "node-1", edges: ["edge-1-2"] },
                { op: [3], pua: [3], description: "Lectura del parámetro P", node: "node-2", edges: ["edge-2-3-then", "edge-2-3-else"] },
                { op: [4], pua: [4], description: "Inicialización de A = 0", node: "node-3", edges: ["edge-3-4"] },
                { op: [], pua: [6], description: "Evaluación de Cond0(P) = False", node: "node-4", edges: ["edge-4-6"] },
                { op: [6], pua: [9], description: "Evaluación de Cond1(P) = True", node: "node-6", edges: ["edge-6-7"] },
                { op: [7], pua: [10], description: "Cálculo de A = AComputation(P)", node: "node-7", edges: ["edge-7-8"] },
                { op: [8], pua: [11], description: "Evaluación de Cond(A) = True", node: "node-8", edges: ["edge-8-10"] },
                { op: [9], pua: [12], description: "Cálculo de R = HeavyRComputation(P, A)", node: "node-10", edges: ["edge-10--2"] },
                { op: [], pua: [19], description: "Ejecución de logValue(R)", node: "node--2", edges: [] },
                { op: [15], pua: [22], description: "Retorno de R - Estado V (Valid)", node: "node--2", edges: [] }
            ];
            
            // Resaltar todas las rutas de ejecución
            const puaLines = [2, 3, 4, 9, 10, 11, 12, 19, 22];
            const opLines = [2, 3, 4, 6, 7, 8, 9, 15];
            
            highlightExecutionPath(opLines, puaLines);
            
            document.getElementById('alignmentTitle').textContent = 'σ-ALINEADAS';
            document.getElementById('execution-content').innerHTML = `
                <div class="scenario">
                    <div class="scenario-title">Escenario 2: Cond0(P) = False, Cond1(P) = True, Cond(A) = True</div>
                    <div class="path">
                        <strong>Ruta PUA:</strong> 2 → 3 → 4 → 9 → 10 → 11 → 12 → 19 → 22<br>
                        <strong>Nodos σ en PUA:</strong> 2, 3, 4, 9, 10, 11, 12, 22
                    </div>
                    <div class="path">
                        <strong>Ruta OP:</strong> 2 → 3 → 4 → 6 → 7 → 8 → 9 → 15<br>
                        <strong>Nodos σ en OP:</strong> 2, 3, 4, 6, 7, 8, 9, 15
                    </div>
                    <div class="path">
                        <strong>Flujo del Monitor:</strong> 1(NV) → 2(NV) → 3(NV) → 4(NV) → 6(NV) → 7(NV) → 8(NV) → 10(NV) → -2(V)<br>
                        <strong>Estado Final:</strong> V (Valid) - Ejecución válida
                    </div>
                    <div class="alignment-result aligned">
                        ✅ σ-ALINEADAS
                    </div>
                    <p><strong>Razón:</strong> Los fragmentos compartidos se ejecutan en el mismo orden relativo. El monitor mantiene estados NV (No Violation) durante toda la ejecución y termina en estado V (Valid), confirmando que la secuencia de operaciones respeta el σ-alineamiento.</p>
                    <ul>
                        <li>Inicialización: (2,2) → (3,3) → (4,4)</li>
                        <li>Lógica principal: (6,9) → (7,10) → (8,11) → (9,12)</li>
                        <li>Finalización: (15,22)</li>
                    </ul>
                </div>
            `;
            
            setupStepControls();
        }
        
        function highlightExecutionPath(opLines, puaLines) {
            // Ocultar colores de código compartido y específico al iniciar ejecución
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('shared', 'specific');
            });
            
            // Resaltar PUA
            document.querySelectorAll('.program')[1].querySelectorAll('.code-line').forEach(line => {
                const lineNum = parseInt(line.getAttribute('data-line'));
                if (puaLines.includes(lineNum)) {
                    line.classList.add('execution-path');
                }
            });
            
            // Resaltar OP
            document.querySelectorAll('.program')[0].querySelectorAll('.code-line').forEach(line => {
                const lineNum = parseInt(line.getAttribute('data-line'));
                if (opLines.includes(lineNum)) {
                    line.classList.add('execution-path');
                }
            });
        }
        
        function setupStepControls() {
            document.getElementById('stepControls').style.display = 'block';
            currentStep = 0;
            updateStepInfo();
            updateStepButtons();
            showStep(0);
        }
        
        function updateStepInfo() {
            document.getElementById('stepInfo').textContent = `Paso ${currentStep + 1} de ${executionSteps.length}`;
        }
        
        function updateStepButtons() {
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep === executionSteps.length - 1;
        }
        
        function showStep(stepIndex) {
            // Limpiar pasos anteriores
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('current-step');
            });
            
            // Limpiar estado anterior del monitor
            document.querySelectorAll('.node').forEach(node => {
                node.classList.remove('current');
            });
            document.querySelectorAll('.edge').forEach(edge => {
                edge.classList.remove('active');
                const originalMarker = edge.classList.contains('decision-then') ? 'url(#arrowhead-then)' :
                                      edge.classList.contains('decision-else') ? 'url(#arrowhead-else)' :
                                      'url(#arrowhead)';
                edge.setAttribute('marker-end', originalMarker);
            });
            
            if (stepIndex >= 0 && stepIndex < executionSteps.length) {
                const step = executionSteps[stepIndex];
                
                // Resaltar líneas del OP
                if (step.op.length > 0) {
                    document.querySelectorAll('.program')[0].querySelectorAll('.code-line').forEach(line => {
                        const lineNum = parseInt(line.getAttribute('data-line'));
                        if (step.op.includes(lineNum)) {
                            line.classList.add('current-step');
                        }
                    });
                }
                
                // Resaltar líneas del PUA
                if (step.pua.length > 0) {
                    document.querySelectorAll('.program')[1].querySelectorAll('.code-line').forEach(line => {
                        const lineNum = parseInt(line.getAttribute('data-line'));
                        if (step.pua.includes(lineNum)) {
                            line.classList.add('current-step');
                        }
                    });
                }
                
                // Resaltar nodo actual en el monitor
                if (step.node) {
                    const currentNode = document.getElementById(step.node);
                    if (currentNode) {
                        currentNode.classList.add('current');
                    }
                }
                
                // Resaltar aristas activas en el monitor
                if (step.edges && step.edges.length > 0) {
                    step.edges.forEach(edgeId => {
                        const edge = document.getElementById(edgeId);
                        if (edge) {
                            edge.classList.add('active');
                            edge.setAttribute('marker-end', 'url(#arrowhead-active)');
                        }
                    });
                }
                
                // Actualizar descripción del paso
                const stepDescription = document.createElement('div');
                stepDescription.style.cssText = 'background: rgba(155, 89, 182, 0.1); padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #9b59b6;';
                stepDescription.innerHTML = `<strong>Paso ${stepIndex + 1}:</strong> ${step.description}`;
                
                // Añadir la descripción al contenido de ejecución
                const executionContent = document.getElementById('execution-content');
                const existingDescription = executionContent.querySelector('.step-description');
                if (existingDescription) {
                    existingDescription.remove();
                }
                stepDescription.className = 'step-description';
                executionContent.appendChild(stepDescription);
            }
        }
        
        function nextStep() {
            if (currentStep < executionSteps.length - 1) {
                currentStep++;
                updateStepInfo();
                updateStepButtons();
                showStep(currentStep);
            }
        }
        
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStepInfo();
                updateStepButtons();
                showStep(currentStep);
            }
        }
        
        function playExecution() {
            if (isPlaying) {
                stopPlayback();
            } else {
                startPlayback();
            }
        }
        
        function startPlayback() {
            isPlaying = true;
            document.getElementById('playBtn').textContent = '⏸ Pausar';
            
            playInterval = setInterval(() => {
                if (currentStep < executionSteps.length - 1) {
                    nextStep();
                } else {
                    stopPlayback();
                }
            }, 1500); // 1.5 segundos entre pasos
        }
        
        function stopPlayback() {
            isPlaying = false;
            document.getElementById('playBtn').textContent = '▶ Reproducir';
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }
        
        // Controles de teclado
        document.addEventListener('keydown', function(event) {
            if (currentScenario && document.getElementById('stepControls').style.display !== 'none') {
                switch(event.key) {
                    case 'ArrowLeft':
                        event.preventDefault();
                        prevStep();
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        nextStep();
                        break;
                    case ' ':
                        event.preventDefault();
                        playExecution();
                        break;
                }
            }
        });
    </script>
</body>
</html>
